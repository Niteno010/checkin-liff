<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß & ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  
  <style>
    body { background-color: #212529; color: #fff; font-family: 'Kanit', sans-serif; padding-bottom: 40px; }
    .main-card { max-width: 500px; margin: 20px auto; background: #fff; color: #333; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    
    /* Tabs ‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ */
    .nav-tabs { border-bottom: none; background: #f1f2f6; }
    .nav-link { width: 50%; text-align: center; padding: 15px; font-weight: bold; color: #636e72; border: none; border-radius: 0; }
    .nav-link.active { background: #d63031; color: white; }
    
    .content-box { padding: 25px; }
    .btn-submit { background-color: #d63031; color: white; width: 100%; padding: 12px; border-radius: 8px; font-weight: bold; border: none; transition: 0.2s; }
    .btn-submit:hover { background-color: #b71c1c; }
    .btn-check { background-color: #0984e3; color: white; width: 100%; padding: 12px; border-radius: 8px; font-weight: bold; border: none; }
    
    /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ */
    .result-card { background: #f8f9fa; border-left: 5px solid #00b894; padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
    .status-badge { display: inline-block; padding: 5px 10px; border-radius: 15px; font-size: 12px; color: white; background: #f39c12; }
    
    .profile-img { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; }
  </style>
</head>
<body>

  <div class="main-card">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="book-tab" onclick="switchTab('book')">üìÖ ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="check-tab" onclick="switchTab('check')">üîç ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
      </li>
    </ul>

    <div class="content-box">
      <div id="book-section">
        <div id="profile-box" class="mb-3 text-center text-muted" style="font-size:14px;"></div>
        
        <form id="bookingForm" onsubmit="submitBooking(event)">
          <div class="mb-3">
            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
            <input type="text" id="name" class="form-control" required>
          </div>
          <div class="row">
            <div class="col-6 mb-3">
              <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
              <input type="tel" id="phone" class="form-control" required>
            </div>
            <div class="col-6 mb-3">
              <label class="form-label">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</label>
              <input type="text" id="plate" class="form-control" required placeholder="‡∏Å‡∏Ç 1234">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
            <select id="service" class="form-select" required>
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ --</option>
              <option value="‡∏ñ‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á">üõ¢ ‡∏ñ‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</option>
              <option value="‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞">üîß ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞</option>
              <option value="‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‚öôÔ∏è ‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
              <option value="‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ">‚ú® ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ</option>
              <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üìù ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
            </select>
          </div>
          <div class="row">
            <div class="col-6 mb-3">
              <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
              <input type="date" id="date" class="form-control" required>
            </div>
            <div class="col-6 mb-3">
              <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤</label>
              <select id="time" class="form-select" required>
                <option value="09:00">09:00</option>
                <option value="10:00">10:00</option>
                <option value="11:00">11:00</option>
                <option value="13:00">13:00</option>
                <option value="14:00">14:00</option>
                <option value="15:00">15:00</option>
                <option value="16:00">16:00</option>
              </select>
            </div>
          </div>
          <button type="submit" id="btnSubmit" class="btn-submit">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
        </form>
      </div>

      <div id="check-section" style="display:none;">
        <div class="text-center mb-4">
          <i class="fas fa-search fa-3x text-muted mb-3"></i>
          <h5>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏¥‡∏ß</h5>
          <p class="text-muted small">‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
        </div>
        
        <div class="input-group mb-3">
          <input type="text" id="checkPlate" class="form-control form-control-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏Ç 1234">
          <button class="btn btn-check" type="button" onclick="checkQueue()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>

        <div id="resultCard" class="result-card">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <strong id="resId" style="color:#d63031;">Q-XXXX</strong>
            <span id="resStatus" class="status-badge">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</span>
          </div>
          <hr>
          <p class="mb-1">üë§ <span id="resName">-</span></p>
          <p class="mb-1">üõ† <span id="resService">-</span></p>
          <p class="mb-1">üìÖ <span id="resDate">-</span> ‡πÄ‡∏ß‡∏•‡∏≤ <span id="resTime">-</span></p>
        </div>
        <div id="notFound" class="text-center text-danger mt-3" style="display:none;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö</div>
      </div>

    </div>
  </div>

  <script>
    const LIFF_ID = "2008660878-lDaGV0kK"; 
    // üî¥ ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå Script ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx432l_zmLUwF47o2TEie2RgiXdGmiERpKDkcjvURfK5TIbPb42MQQLU0OWJyc4b8_D/exec";

    window.onload = async () => { await initLiff(); };

    async function initLiff() {
      await liff.init({ liffId: LIFF_ID });
      if (liff.isLoggedIn()) {
        const profile = await liff.getProfile();
        document.getElementById('name').value = profile.displayName;
        document.getElementById('profile-box').innerHTML = 
          `<img src="${profile.pictureUrl}" class="profile-img"> ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì <b>${profile.displayName}</b>`;
      } else { liff.login(); }
    }

    function switchTab(tab) {
      if(tab === 'book') {
        document.getElementById('book-section').style.display = 'block';
        document.getElementById('check-section').style.display = 'none';
        document.getElementById('book-tab').classList.add('active');
        document.getElementById('check-tab').classList.remove('active');
      } else {
        document.getElementById('book-section').style.display = 'none';
        document.getElementById('check-section').style.display = 'block';
        document.getElementById('book-tab').classList.remove('active');
        document.getElementById('check-tab').classList.add('active');
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß
    function submitBooking(e) {
      e.preventDefault();
      const btn = document.getElementById('btnSubmit');
      btn.innerText = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
      btn.disabled = true;

      const payload = {
        action: 'booking', // ‡∏ö‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        plate: document.getElementById('plate').value,
        service: document.getElementById('service').value,
        date: document.getElementById('date').value,
        time: document.getElementById('time').value
      };

      fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).then(() => {
        // ‚úÖ 1. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó (‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à)
        sendLineMessage(payload);
        
        // ‚úÖ 2. ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
        alert("‚úÖ ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö");
        liff.closeWindow();
      }).catch(err => {
        alert("Error: " + err);
        btn.innerText = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
        btn.disabled = false;
      });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ LINE (‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à)
    function sendLineMessage(data) {
      if (liff.isInClient()) {
        liff.sendMessages([{
          type: 'text',
          text: `üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß\n------------------\nüë§ ${data.name}\nüöó ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: ${data.plate}\nüõ† ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ${data.service}\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${data.date}\n‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${data.time}\n------------------\n*‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö`
        }]).catch(err => console.log('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:', err));
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    function checkQueue() {
      const plate = document.getElementById('checkPlate').value;
      if(!plate) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");

      const btn = document.querySelector('.btn-check');
      btn.innerText = '‚è≥ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...';
      
      const payload = { action: 'search', plate: plate };

      // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å no-cors ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ redirect ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ doPost ‡πÅ‡∏ö‡∏ö ContentService.JSON 
      // ‡πÅ‡∏ï‡πà‡πÉ‡∏ô GitHub Pages + GAS ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡πÉ‡∏ä‡πâ fetch ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ GAS ‡πÉ‡∏´‡πâ return JSONP ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
      // ** ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡πÉ‡∏ô GAS ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ ContentService.MimeType.JSON ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô JS ‡πÉ‡∏ä‡πâ fetch ‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏ï‡πà‡∏£‡∏≠ response **
      
      // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà ‡∏ú‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡πà‡∏≤ "form submit" ‡πÑ‡∏õ‡∏¢‡∏±‡∏á iframe ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ library ‡πÄ‡∏™‡∏£‡∏¥‡∏°
      // ‡πÅ‡∏ï‡πà‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô fetch ‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î CORS ‡∏Ñ‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏Å‡∏±‡∏ô
      
      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(data => {
        btn.innerText = '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
        if(data.result === 'found') {
          const info = data.data;
          document.getElementById('notFound').style.display = 'none';
          document.getElementById('resultCard').style.display = 'block';
          
          document.getElementById('resId').innerText = info.id;
          document.getElementById('resName').innerText = info.name;
          document.getElementById('resService').innerText = info.service;
          document.getElementById('resDate').innerText = info.date;
          document.getElementById('resTime').innerText = info.time;
          document.getElementById('resStatus').innerText = info.status;
        } else {
          document.getElementById('resultCard').style.display = 'none';
          document.getElementById('notFound').style.display = 'block';
        }
      })
      .catch(err => {
        // ‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î CORS ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤: ‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        console.error(err);
        btn.innerText = '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
        // (‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î CORS ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡∏™‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤ Error)
      });
    }
  </script>
</body>
</html>
