<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß - 9 Auto Garage</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  
  <style>
    body { background-color: #212529; color: #fff; font-family: 'Kanit', sans-serif; padding-bottom: 40px; }
    .main-card { max-width: 500px; margin: 20px auto; background: #fff; color: #333; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    
    .content-box { padding: 25px; }
    
    /* ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ */
    .btn-submit { background-color: #d63031; color: white; width: 100%; padding: 12px; border-radius: 8px; font-weight: bold; border: none; transition: 0.2s; }
    .btn-submit:hover { background-color: #b71c1c; }

    .btn-search-queue { background-color: #0984e3; color: white; width: 100%; padding: 12px; border-radius: 8px; font-weight: bold; border: none; cursor: pointer; }
    .btn-search-queue:hover { background-color: #076aad; }

    /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô */
    .btn-type { padding: 20px 15px; border-radius: 12px; font-size: 18px; font-weight: 600; margin-bottom: 15px; transition: transform 0.2s; width: 100%; text-align: left; }
    .btn-type:hover { transform: translateY(-3px); }
    .btn-service { background: #27ae60; color: white; border: none; }
    .btn-claim { background: #f39c12; color: white; border: none; }
    
    /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå */
    .result-card { background: #f8f9fa; border-left: 5px solid #00b894; padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
    .status-badge { display: inline-block; padding: 5px 10px; border-radius: 15px; font-size: 12px; color: white; }
    .profile-img { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; }

    /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà */
    .status-WAIT { background-color: #3498db !important; } /* ‡∏ü‡πâ‡∏≤ */
    .status-IN_BAY { background-color: #e67e22 !important; } /* ‡∏™‡πâ‡∏° */
    .status-DONE { background-color: #2ecc71 !important; } /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
    .status-PICKED { background-color: #9b59b6 !important; } /* ‡∏°‡πà‡∏ß‡∏á */
  </style>
</head>
<body>

  <div class="main-card">
    <div class="content-box">

      <div id="check-section" class="mb-5">
        <div class="text-center mb-4">
          <i class="fas fa-search fa-3x text-muted mb-3"></i>
          <h5 class="text-dark">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏¥‡∏ß</h5>
          <p class="text-muted small">‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏ó‡∏±‡πâ‡∏á‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏™‡∏µ)</p>
        </div>
        <div class="input-group mb-3">
          <input type="text" id="checkPlate" class="form-control form-control-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏Ç 1234">
          <button id="btnCheck" class="btn btn-search-queue" type="button" onclick="checkQueue()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>
        
        <div id="resultCard" class="result-card">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <strong id="resId" style="color:#d63031;">Q-XXXX</strong>
            <span id="resType" class="badge bg-secondary">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</span>
          </div>
          <div class="mb-2">
            <span id="resStatus" class="status-badge bg-secondary">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>
          </div>
          <hr>
          <p class="mb-1">üë§ <span id="resName">-</span></p>
          <p class="mb-1">üõ† <span id="resService">-</span></p>
          <p class="mb-1">üìÖ <span id="resDate">-</span> ‡πÄ‡∏ß‡∏•‡∏≤ <span id="resTime">-</span></p>
        </div>
        <div id="notFound" class="text-center text-danger mt-3" style="display:none;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö</div>
      </div>

      <hr class="text-muted">

      <div id="type-section" class="text-center mt-4">
        <h5 class="text-dark mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h5>
        <div class="row">
            <div class="col-12"><button class="btn btn-type btn-service" onclick="showForm('SERVICE')"><i class="fas fa-wrench me-2"></i> ‡∏à‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á / ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™</button></div>
            <div class="col-12"><button class="btn btn-type btn-claim" onclick="showForm('CLAIM')"><i class="fas fa-paint-roller me-2"></i> ‡∏à‡∏≠‡∏á‡πÄ‡∏Ñ‡∏•‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô / ‡∏ó‡∏≥‡∏™‡∏µ</button></div>
        </div>
      </div>

      <div id="booking-form-section" style="display:none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
             <button class="btn btn-sm btn-outline-secondary" onclick="backToMenu()">‚ùÆ ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        </div>
        <h5 class="text-dark mb-4 text-center" id="form-title"></h5>
        
        <div id="profile-box" class="mb-3 text-center text-muted" style="font-size:14px;"></div>
        
        <form id="bookingForm" onsubmit="submitBooking(event)">
          <input type="hidden" id="serviceTypeInput">
          <div class="mb-3"><label class="form-label text-dark">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label><input type="text" id="name" class="form-control" required></div>
          <div class="row">
            <div class="col-6 mb-3"><label class="form-label text-dark">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input type="tel" id="phone" class="form-control" required></div>
            <div class="col-6 mb-3"><label class="form-label text-dark">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</label><input type="text" id="plate" class="form-control" required placeholder="‡∏Å‡∏Ç 1234"></div>
          </div>
          <div class="mb-3"><label class="form-label text-dark" id="service-label">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
            <select id="service" class="form-select" required></select>
          </div>
          <div class="row">
            <div class="col-6 mb-3"><label class="form-label text-dark">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="date" class="form-control" required></div>
            <div class="col-6 mb-3"><label class="form-label text-dark">‡πÄ‡∏ß‡∏•‡∏≤</label>
              <select id="time" class="form-select" required>
                <option value="09:00">09:00</option><option value="10:00">10:00</option><option value="11:00">11:00</option>
                <option value="13:00">13:00</option><option value="14:00">14:00</option><option value="15:00">15:00</option><option value="16:00">16:00</option>
              </select>
            </div>
          </div>
          <button type="submit" id="btnSubmit" class="btn-submit">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
        </form>
      </div>

    </div>
  </div>

  <script>
    // **********************************************
    // ‚ö†Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö
    const LIFF_ID = "2008660878-lDaGV0kK"; 
    // ‡∏ú‡∏°‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzJK22GPq-MQrrAvQsP3U5FhrCe3ixJjWQaeLdmCTU95KqckxVv5HKxvciTJjYZVU7Y/exec"; 
    // **********************************************

    window.onload = async () => { await initLiff(); };

    async function initLiff() {
      await liff.init({ liffId: LIFF_ID });
      if (liff.isLoggedIn()) {
        const profile = await liff.getProfile();
        document.getElementById('name').value = profile.displayName;
        document.getElementById('profile-box').innerHTML = `<img src="${profile.pictureUrl}" class="profile-img"> ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì <b>${profile.displayName}</b>`;
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
    function showForm(type) {
        document.getElementById('type-section').style.display = 'none';
        document.getElementById('booking-form-section').style.display = 'block';
        document.getElementById('serviceTypeInput').value = type;
        
        const serviceSelect = document.getElementById('service');
        serviceSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';

        if (type === 'SERVICE') {
            document.getElementById('form-title').innerText = 'üìÖ ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß: ‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á';
            const serviceOptions = [
                { text: 'üõ¢ ‡∏ñ‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á', value: '‡∏ñ‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á' },
                { text: 'üîß ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞', value: '‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞' },
                { text: '‚öôÔ∏è ‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', value: '‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' },
                { text: '‚ú® ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ', value: '‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ' },
                { text: 'üìù ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏)', value: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' }
            ];
            serviceOptions.forEach(opt => serviceSelect.add(new Option(opt.text, opt.value)));
        } else if (type === 'CLAIM') {
            document.getElementById('form-title').innerText = 'üìÖ ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß: ‡πÄ‡∏Ñ‡∏•‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô / ‡∏ó‡∏≥‡∏™‡∏µ';
            const claimOptions = [
                { text: 'üõ° ‡πÄ‡∏Ñ‡∏•‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô (‡∏ã‡πà‡∏≠‡∏°‡∏ï‡∏±‡∏ß‡∏ñ‡∏±‡∏á)', value: '‡πÄ‡∏Ñ‡∏•‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô' },
                { text: 'üé® ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏≥‡∏™‡∏µ (‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•)', value: '‡∏ó‡∏≥‡∏™‡∏µ' },
                { text: 'üöó ‡∏ä‡∏ô‡πÄ‡∏ö‡∏≤/‡∏ó‡∏≥‡∏™‡∏µ‡∏î‡πà‡∏ß‡∏ô', value: '‡∏ó‡∏≥‡∏™‡∏µ‡∏î‡πà‡∏ß‡∏ô' },
            ];
            claimOptions.forEach(opt => serviceSelect.add(new Option(opt.text, opt.value)));
        }
    }
    
    function backToMenu() {
        document.getElementById('booking-form-section').style.display = 'none';
        document.getElementById('type-section').style.display = 'block';
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (POST)
    function submitBooking(e) {
      e.preventDefault();
      const btn = document.getElementById('btnSubmit');
      btn.innerText = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...'; btn.disabled = true;

      const type = document.getElementById('serviceTypeInput').value;
      const payload = {
        name: document.getElementById('name').value, phone: document.getElementById('phone').value,
        plate: document.getElementById('plate').value, service: document.getElementById('service').value,
        date: document.getElementById('date').value, time: document.getElementById('time').value,
        type: type 
      };

      fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).then(() => {
        if (liff.isInClient()) {
           liff.sendMessages([{ type: 'text', text: `üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß (${type === 'CLAIM' ? '‡πÄ‡∏Ñ‡∏•‡∏°/‡∏ó‡∏≥‡∏™‡∏µ' : '‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á'})\n------------------\nüë§ ${payload.name}\nüöó ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: ${payload.plate}\nüõ† ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ${payload.service}\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${payload.date}\n‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${payload.time}\n------------------\n*‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô` }]).catch(e=>{});
        }
        alert("‚úÖ ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
        liff.closeWindow();
      }).catch(err => { alert("Error: " + err); btn.innerText = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á'; btn.disabled = false; });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (GET)
    function checkQueue() {
      const plate = document.getElementById('checkPlate').value;
      if(!plate) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô");
      
      const btn = document.getElementById('btnCheck');
      btn.innerText = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...'; btn.disabled = true;
      
      fetch(SCRIPT_URL + "?action=search&plate=" + encodeURIComponent(plate))
      .then(res => res.json())
      .then(data => {
        btn.innerText = '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤'; btn.disabled = false;
        document.getElementById('notFound').style.display = 'none';

        if(data.result === 'found') {
          const info = data.data;
          document.getElementById('resultCard').style.display = 'block';
          
          document.getElementById('resId').innerText = info.id;
          document.getElementById('resName').innerText = info.name;
          document.getElementById('resService').innerText = info.service;
          document.getElementById('resDate').innerText = info.date;
          document.getElementById('resTime').innerText = info.time;
          
          const statusBadge = document.getElementById('resStatus');
          statusBadge.innerText = convertStatus(info.status);
          statusBadge.className = `status-badge status-${info.status}`; 
          
          const typeBadge = document.getElementById('resType');
          typeBadge.innerText = info.type === 'CLAIM' ? '‡πÄ‡∏Ñ‡∏•‡∏°/‡∏ó‡∏≥‡∏™‡∏µ' : '‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á';

        } else {
          document.getElementById('resultCard').style.display = 'none';
          document.getElementById('notFound').style.display = 'block';
        }
      })
      .catch(err => { 
        console.error(err);
        alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ"); 
        btn.innerText = '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤'; btn.disabled = false; 
      });
    }

    function convertStatus(code) {
      const map = {
        'WAIT': '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
        'IN_BAY': '‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ã‡πà‡∏≠‡∏°/‡∏™‡∏µ',
        'DONE': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏£‡∏ñ',
        'PICKED': '‡∏£‡∏±‡∏ö‡∏£‡∏ñ‡πÅ‡∏•‡πâ‡∏ß'
      };
      return map[code] || '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö';
    }
  </script>
</body>
</html>
