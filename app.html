<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡πä‡∏≠‡∏ö - ‡πô ‡∏≠‡∏≠‡πÇ‡∏ï‡πâ ‡∏Å‡∏≤‡∏£‡∏≤‡∏à</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --bg: #f0f2f5; --primary: #1a1a1a; --accent: #ff3b30; --success: #28a745; --text: #333; --card-bg: #fff; }
        body { font-family: 'Kanit', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding-bottom: 70px; }
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        
        /* ‡πÄ‡∏°‡∏ô‡∏π‡∏•‡πà‡∏≤‡∏á */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: flex; z-index: 1000; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; text-align: center; padding: 12px 0; color: #888; font-size: 13px; cursor: pointer; transition: 0.3s; position: relative; }
        .nav-item i { display: block; font-size: 20px; margin-bottom: 4px; }
        .nav-item.active { color: var(--primary); font-weight: 500; }
        .nav-item.active i { color: var(--accent); }
        .badge { position: absolute; top: 5px; right: 20vw; background: var(--accent); color: #fff; font-size: 11px; padding: 2px 6px; border-radius: 10px; font-weight: bold; display: none; }

        /* ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡πä‡∏≠‡∏ö */
        .segment-control { display: flex; background: #e0e0e0; border-radius: 10px; padding: 4px; margin-bottom: 20px; }
        .seg-btn { flex: 1; text-align: center; padding: 12px 5px; border-radius: 8px; border: none; background: transparent; color: #666; font-size: 15px; font-family: 'Kanit'; font-weight: 500; cursor: pointer; transition: 0.3s; }
        .seg-btn.active { background: #fff; color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-weight: 600; }

        /* Tabs ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ‡∏ü‡∏≠‡∏£‡πå‡∏° */
        .search-box { background: var(--card-bg); padding: 15px; border-radius: 12px; position: sticky; top: 10px; z-index: 100; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        input[type="text"], input[type="number"], textarea, select { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-family: 'Kanit'; font-size: 16px; box-sizing: border-box; background: #f9f9f9; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent); background: #fff; }
        textarea { min-height: 80px; resize: vertical; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 5px; color: #555; }
        .section-title { font-size: 18px; border-bottom: 2px solid #eee; padding-bottom: 8px; margin-bottom: 15px; color: var(--primary); margin-top: 15px; }

        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ */
        .item-card { background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .sell-price { color: var(--success); font-weight: bold; font-size: 18px; }
        .btn-add { width: 100%; margin-top: 10px; background: #e8f5e9; color: var(--success); border: 1px solid var(--success); padding: 10px; border-radius: 8px; font-family: 'Kanit'; font-weight: 500; cursor: pointer; }

        /* ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ UI */
        .cart-item { background: #f9f9f9; padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #eee; }
        .cart-item-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: 500; }
        .cart-item-price-row { display: flex; align-items: center; justify-content: space-between; }
        .price-input { width: 100px !important; padding: 8px !important; text-align: right; color: var(--success); font-weight: bold; border: 1px solid #ccc !important; }
        .btn-remove { color: #dc3545; background: none; border: none; font-size: 18px; cursor: pointer; padding: 5px; }
        .btn-custom { background: #fff; border: 1px dashed #aaa; color: #555; padding: 12px; width: 100%; border-radius: 8px; font-family: 'Kanit'; cursor: pointer; margin-bottom: 15px; }

        .total-box { background: var(--primary); color: #fff; padding: 15px; border-radius: 12px; text-align: right; font-size: 20px; font-weight: bold; margin-bottom: 20px; }
        .btn-submit { width: 100%; background: var(--primary); color: #fff; border: none; padding: 15px; border-radius: 12px; font-family: 'Kanit'; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .btn-submit.close-job { background: var(--success); box-shadow: 0 4px 10px rgba(40,167,69,0.2); }
    </style>
</head>
<body>

<div id="tab-search" class="tab-content container">
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="üîç ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ..." onkeyup="filterItems()">
    </div>
    <div id="loading" style="text-align: center; color: #888; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    <div id="resultsList"></div>
</div>

<div id="tab-job" class="tab-content active container">
    
    <div class="segment-control">
        <button class="seg-btn active" id="btn-mode-new" onclick="setJobMode('new')">üÜï ‡∏£‡∏±‡∏ö‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
        <button class="seg-btn" id="btn-mode-update" onclick="setJobMode('update')">üõ†Ô∏è ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°</button>
    </div>

    <div id="mode-new">
        <div style="background: #fff3cd; color: #856404; padding: 10px; border-radius: 8px; font-size: 13px; margin-bottom: 15px;">
            <i class="fas fa-info-circle"></i> ‡πÇ‡∏´‡∏°‡∏î‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏î‡∏£‡∏±‡∏ö‡∏£‡∏ñ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô "‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£")
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="form-group">
                <label>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ <span style="color:red;">*</span></label>
                <input type="text" id="new-plate" placeholder="‡∏Å‡∏Ç 1234">
            </div>
            <div class="form-group">
                <label>‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå <span style="color:red;">*</span></label>
                <input type="number" id="new-mileage" placeholder="120500">
            </div>
        </div>
        
        <div class="form-group">
            <label>‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
            <input type="text" id="new-model" placeholder="Almera / 08X-XXX-XXXX">
        </div>
        
        <div class="form-group">
            <label>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏à‡πâ‡∏á <span style="color:red;">*</span></label>
            <textarea id="new-symptoms" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á‡∏•‡πâ‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏ß‡∏≤, ‡πÅ‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÄ‡∏¢‡πá‡∏ô..."></textarea>
        </div>

        <button class="btn-submit" onclick="saveNewJob()"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏±‡∏ö‡∏£‡∏ñ (‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡πä‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà)</button>
    </div>

    <div id="mode-update" style="display: none;">
        
        <div class="form-group">
            <label><i class="fas fa-car-side"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏° (‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£)</label>
            <select id="active-jobs-select" onchange="loadActiveJobData()">
                <option value="">-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ... --</option>
            </select>
        </div>

        <h3 class="section-title"><i class="fas fa-wrench"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏° / ‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ö‡∏¥‡∏•‡∏ô‡∏µ‡πâ</h3>
        <div id="cartList" style="margin-bottom: 10px; font-size: 14px; color: #888; text-align: center; padding: 10px; background: #eee; border-radius: 8px;">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏¥‡∏ö‡∏Ç‡∏≠‡∏á)
        </div>
        
        <button class="btn-custom" onclick="addCustomItem()">
            <i class="fas fa-plus"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏á (‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á / ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏ñ / ‡∏≠‡∏∑‡πà‡∏ô‡πÜ)
        </button>

        <div class="form-group" style="margin-top: 15px;">
            <label>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥/‡∏≠‡∏≤‡∏Å‡∏≤‡∏£/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏≤‡πÉ‡∏´‡πâ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ)</label>
            <textarea id="update-details" placeholder="‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏ñ‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ..."></textarea>
        </div>

        <div class="total-box">
            ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: <span id="grandTotal">0</span> ‡∏ø
        </div>

        <div class="form-group" style="background: #e8f4f8; padding: 15px; border-radius: 12px; border: 1px solid #b8daff;">
            <label style="color: #0056b3;"><i class="fas fa-flag-checkered"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏¥‡∏•</label>
            <select id="update-status" style="font-weight: bold; color: #333;">
                <option value="‡∏õ‡∏¥‡∏î‡∏à‡πä‡∏≠‡∏ö">‚úÖ ‡∏õ‡∏¥‡∏î‡∏à‡πä‡∏≠‡∏ö (‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô)</option>
                <option value="‡πÅ‡∏Ñ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤">üìù ‡πÅ‡∏Ñ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ / ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô</option>
                <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (‡∏î‡∏≠‡∏á‡∏ö‡∏¥‡∏•‡πÑ‡∏ß‡πâ‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô)</option>
            </select>
        </div>

        <button class="btn-submit close-job" id="btnUpdateJob" onclick="updateJob()"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item" id="nav-search" onclick="switchTab('search')">
        <i class="fas fa-search"></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà
    </div>
    <div class="nav-item active" id="nav-job" onclick="switchTab('job')">
        <i class="fas fa-clipboard-list"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡πä‡∏≠‡∏ö
        <span class="badge" id="cartBadge">0</span>
    </div>
</nav>

<script>
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzgVz1m_VdZOyiLZjkbXaITInll47yRp1QmFDc6OCbdyedJLlcI-WXlNA1WBsWsEGwMJg/exec";
    
    let allItems = []; 
    let activeJobs = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î‡∏à‡πä‡∏≠‡∏ö
    let cart = []; 

    // ‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ
    fetch(GOOGLE_SCRIPT_URL)
        .then(response => response.json())
        .then(data => {
            if(data.status === 'success') {
                allItems = data.data;
                document.getElementById('loading').style.display = 'none';
                renderItems(allItems); 
            }
        });

    // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£"
    function fetchActiveJobs() {
        fetch(GOOGLE_SCRIPT_URL + "?action=get_active_jobs")
            .then(response => response.json())
            .then(data => {
                if(data.status === 'success') {
                    activeJobs = data.data;
                    const select = document.getElementById('active-jobs-select');
                    select.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ --</option>';
                    if(activeJobs.length === 0) {
                        select.innerHTML = '<option value="">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏ñ‡∏Ñ‡πâ‡∏≤‡∏á‡∏ã‡πà‡∏≠‡∏° (‡∏ß‡πà‡∏≤‡∏á)</option>';
                    } else {
                        activeJobs.forEach(job => {
                            select.innerHTML += `<option value="${job.plate}">${job.plate} (‡πÑ‡∏°‡∏•‡πå: ${job.mileage})</option>`;
                        });
                    }
                }
            });
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    fetchActiveJobs();

    // ==========================================
    // UI ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤/‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î
    // ==========================================
    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
        document.getElementById('nav-' + tabName).classList.add('active');
        window.scrollTo(0, 0); 
    }

    function setJobMode(mode) {
        document.getElementById('btn-mode-new').classList.remove('active');
        document.getElementById('btn-mode-update').classList.remove('active');
        document.getElementById('mode-new').style.display = 'none';
        document.getElementById('mode-update').style.display = 'none';

        document.getElementById('btn-mode-' + mode).classList.add('active');
        document.getElementById('mode-' + mode).style.display = 'block';

        if(mode === 'update') fetchActiveJobs(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏™‡∏°‡∏≠
    }

    // ==========================================
    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î)
    // ==========================================
    function filterItems() {
        const text = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allItems.filter(item => 
            item.name.toLowerCase().includes(text) || item.model.toLowerCase().includes(text)
        );
        renderItems(filtered);
    }

    function renderItems(items) {
        const list = document.getElementById('resultsList');
        list.innerHTML = '';
        items.forEach(item => {
            const price = item.sellPrice ? item.sellPrice : 0;
            list.innerHTML += `
                <div class="item-card">
                    <div style="display:flex; justify-content:space-between;">
                        <div>
                            <div style="font-weight:600; font-size:15px;">${item.name}</div>
                            <div style="font-size:12px; color:#666;">‡∏£‡∏∏‡πà‡∏ô: ${item.model}</div>
                        </div>
                        <div class="sell-price">${price.toLocaleString()} ‡∏ø</div>
                    </div>
                    <button class="btn-add" onclick="addToCart('${item.name}', ${price})">
                        <i class="fas fa-plus-circle"></i> ‡∏´‡∏¢‡∏¥‡∏ö‡πÉ‡∏™‡πà‡∏ö‡∏¥‡∏•
                    </button>
                </div>
            `;
        });
    }

    function addToCart(name, price) {
        cart.push({ name: name, price: price });
        updateCartUI();
        alert(`‚úÖ ‡∏´‡∏¢‡∏¥‡∏ö "${name}" ‡πÉ‡∏™‡πà‡∏ö‡∏¥‡∏•‡πÅ‡∏•‡πâ‡∏ß`);
    }

    function addCustomItem() {
        const name = prompt("‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á, ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡πÇ‡∏Ñ‡πâ‡∏î):");
        if(name) {
            let price = prompt("‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏ü‡∏£‡∏µ/‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà 0):", "0");
            cart.push({ name: name, price: parseInt(price) || 0 });
            updateCartUI();
        }
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        updateCartUI();
    }

    function changeItemPrice(index, newPrice) {
        cart[index].price = parseInt(newPrice) || 0;
        updateTotal(); 
    }

    function updateCartUI() {
        const list = document.getElementById('cartList');
        const badge = document.getElementById('cartBadge');
        
        if(cart.length > 0) {
            badge.style.display = 'block'; badge.innerText = cart.length; list.style.background = 'transparent';
        } else {
            badge.style.display = 'none';
        }

        list.innerHTML = '';
        if(cart.length === 0) {
            list.innerHTML = '<div style="text-align:center; padding:10px; background:#eee; border-radius:8px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤</div>';
        } else {
            cart.forEach((item, index) => {
                list.innerHTML += `
                    <div class="cart-item">
                        <div class="cart-item-header">
                            <span><b>${index+1}.</b> ${item.name}</span>
                            <button class="btn-remove" onclick="removeFromCart(${index})"><i class="fas fa-trash-alt"></i></button>
                        </div>
                        <div class="cart-item-price-row">
                            <span style="font-size:12px; color:#888;">‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤ ‚ûî</span>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <input type="number" class="price-input" value="${item.price}" onkeyup="changeItemPrice(${index}, this.value)" onchange="changeItemPrice(${index}, this.value)">
                                <span style="font-weight:bold;">‡∏ø</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        updateTotal();
    }

    function updateTotal() {
        let total = cart.reduce((sum, item) => sum + item.price, 0);
        document.getElementById('grandTotal').innerText = total.toLocaleString();
    }

    // ==========================================
    // üî¥ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ Google Sheets
    // ==========================================

    // 1. ‡πÇ‡∏´‡∏°‡∏î‡∏£‡∏±‡∏ö‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
    function saveNewJob() {
        const plate = document.getElementById('new-plate').value;
        const mileage = document.getElementById('new-mileage').value;
        const symptoms = document.getElementById('new-symptoms').value;

        if (!plate || !mileage || !symptoms) {
            alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô, ‡πÑ‡∏°‡∏•‡πå ‡πÅ‡∏•‡∏∞ ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡∏Ñ‡∏£‡∏±‡∏ö"); return;
        }

        const payload = {
            action: "add_job",
            plate: plate,
            model: document.getElementById('new-model').value,
            mileage: mileage,
            details: "[‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏£‡∏ñ]:\n" + symptoms,
            total: 0, // ‡∏£‡∏±‡∏ö‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà ‡∏¢‡∏≠‡∏î‡πÄ‡∏õ‡πá‡∏ô 0
            phone: "" 
        };

        submitData(payload, "‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡πä‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
    }

    // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ
    function loadActiveJobData() {
        const plate = document.getElementById('active-jobs-select').value;
        const job = activeJobs.find(j => j.plate === plate);
        if(job) {
            // ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏≤‡πÅ‡∏õ‡∏∞‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏π‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ
            document.getElementById('update-details').value = job.details + "\n\n[‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï]:\n";
        } else {
            document.getElementById('update-details').value = "";
        }
    }

    // 3. ‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï/‡∏ï‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏õ‡∏¥‡∏î‡∏à‡πä‡∏≠‡∏ö
    function updateJob() {
        const plate = document.getElementById('active-jobs-select').value;
        if (!plate) { alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏£‡∏±‡∏ö"); return; }

        let currentDetails = document.getElementById('update-details').value;
        let finalStatus = document.getElementById('update-status').value;
        
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        if(cart.length > 0) {
            currentDetails += `\n\n[‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£]:\n`;
            cart.forEach(item => {
                let priceText = item.price > 0 ? `${item.price} ‡∏ö.` : `‡∏ü‡∏£‡∏µ`;
                currentDetails += `- ${item.name} (${priceText})\n`;
            });
        }

        const grandTotal = document.getElementById('grandTotal').innerText.replace(/,/g, '');

        const payload = {
            action: "update_job",
            plate: plate,
            details: currentDetails.trim(),
            total: grandTotal,
            status: finalStatus
        };

        submitData(payload, "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
    }

    // ‡∏ï‡∏±‡∏ß‡∏¢‡∏¥‡∏á API ‡∏Å‡∏•‡∏≤‡∏á
    function submitData(payload, successMsg) {
        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(payload),
            headers: { 'Content-Type': 'text/plain;charset=utf-8' }
        })
        .then(response => response.json())
        .then(data => {
            if(data.status === 'success') {
                alert("‚úÖ " + successMsg);
                location.reload(); 
            } else {
                alert("‚ùå ‡∏û‡∏•‡∏≤‡∏î‡πÅ‡∏•‡πâ‡∏ß: " + data.message);
            }
        });
    }
</script>
</body>
</html>
